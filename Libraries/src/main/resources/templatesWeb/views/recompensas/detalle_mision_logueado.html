<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Membership Rewards</title>
  <th:block th:replace="~{fragments/recompensas/resources :: styles}" />
</head>

<body>
  <!-- Header -->
  <nav class="g-header">
    <div class="container">
      <div class="g-header--container">
        <a class="g-header--container__logo" href="index.html">
          <img th:src="${@resources.web('recompensa/img/logo.png')}" alt="Logo" class="logo">
        </a>
        <div class="dropdown">
          <button class="g-button--profile" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <img th:src="${@resources.web('recompensa/img/ico/ico-profile.svg')}" alt="">
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="./index.html">Cerrar sesión</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <section class="container">
    <div class="g-back">
      <a class="g-button--secondary" href="index-logeado.html">
        <img th:src="${@resources.web('recompensa/img/ico/ico-left.svg')}" alt="">
        <span>Regresar</span>
      </a>
    </div>
  </section>

  <section class="container">
    <div>
      <h3 class="g-subtitle mb-4">Haz un consumo digital y recibe recompensas</h3>
      <div class="g-box mb-4">
        <div class="mb-2">
          <span class="g-tag">Completada</span>
        </div>
        <div class="g-progress-bar mb-2">
          <span style="width: 100%;"></span>
        </div>
        <span>100%</span>
      </div>
      <div class="g-box mb-4">
        <p class="g-box--title">Descripción / Requisitos:</p>
        <p class="g-box--description"  id="descripcion_mision"></p>
        <p class="g-box--description2 m-0"  id="fecha_mision">Válido hasta: 30 de noviembre 2024</p>
      </div>
    </div>
    <div>
      <div class="g-texto">
        <h3 class="g-texto--title">Recompensa elegida:</h3>
      </div>

      <div class="reward-options" id="recompensas_lista">
        <div class="reward-option selected" data-reward="suscripciones">
          <div>
            <span class="reward-title">Pago suscripciones</span>
            <span class="reward-desc">Paga tu suscripción de Spotify o Netflix y recibe el siguiente mes gratis.</span>
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-center mb-5">
        <div class="g-button--fix">
          <a href="../../login" class="g-button g-button--big">
            <span>Ver promociones</span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="g-footer">
    <div class="container">
      <div class="g-footer--container">
        <div class="row">
          <div class="col-lg-6">
            <div class="g-footer--logo">
              <img th:src="${@resources.web('recompensa/img/logo-footer.svg')}" alt="Logo">
            </div>
            <div>
              <p class="g-footer--social__title">Síguenos en redes</p>
              <ul class="g-footer--social">
                <li>
                  <a href="">
                    <img th:src="${@resources.web('recompensa/img/ico/ico-facebook.svg')}" alt="">
                  </a>
                </li>
                <li>
                  <a href="">
                    <img th:src="${@resources.web('recompensa/img/ico/ico-instagram.svg')}" alt="">
                  </a>
                </li>
                <li>
                  <a href="">
                    <img th:src="${@resources.web('recompensa/img/ico/ico-youtube.svg')}" alt="">
                  </a>
                </li>
                <li>
                  <a href="">
                    <img th:src="${@resources.web('recompensa/img/ico/ico-tiktok.svg')}" alt="">
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="row">
              <div class="col-lg-6">
                <div class="g-footer--info">
                  <p class="g-footer--info__title">Información</p>
                  <ul class="g-footer--info__list">
                    <li>
                      <a href="">Preguntas frecuentes</a>
                    </li>
                    <li>
                      <a href="">Términos y Condiciones</a>
                    </li>
                    <li>
                      <a href="">Políticas de Privacidad</a>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="g-footer--info">
                  <p class="g-footer--info__title">Contacto</p>
                  <ul class="g-footer--info__list">
                    <li>
                      <a href="">
                        <img th:src="${@resources.web('recompensa/img/ico/ico-clock.svg')}" alt="">
                        <span>Lun-Vie de 9 am a 6 pm</span>
                      </a>
                    </li>
                    <li>
                      <a href="">
                        <img th:src="${@resources.web('recompensa/img/ico/ico-whatsapp.svg')}" alt="">
                        <span>+593 xxx xxx xxx</span>
                      </a>
                    </li>
                    <li>
                      <a href="">
                        <img th:src="${@resources.web('recompensa/img/ico/ico-mail.svg')}" alt="">
                        <span>soporte@membershiprewards.com.ec</span>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="g-footer--separator"></div>
        <div class="g-footer--copyright">
          <p>American Express Membership Rewards x Banco Guayaquil</p>
          <p>© 2025 Todos los derechos reservados</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS Bundle with Popper -->
  <th:block th:replace="~{fragments/recompensas/resources :: script}" />

  <script>
    $(function() {
      function renderChecks() {
        $('.reward-option').each(function() {
          var $checkSpan = $(this).find('.reward-check');
          $checkSpan.empty();
          if ($(this).hasClass('selected')) {
            var icon = lucide.createElement('Check', { color: '#fff', size: 18, strokeWidth: 3 });
            $checkSpan.append(icon);
          }
        });
      }
  
      $('.reward-option').on('click', function() {
        $('.reward-option').removeClass('selected');
        $(this).addClass('selected');
        renderChecks();
      });
  
      // Render inicial
      renderChecks();
    });

    // Captura el id_mision desde el modelo Thymeleaf
    var id_mision = /*[[${id_mision}]]*/ '';
    console.log("id_mision:", id_mision);

    // Ejemplo de uso: puedes llamar tu función AJAX aquí
    cargarMisionAjax(id_mision);

    function cargarMisionAjax(id_mision) {
      traerMision(id_mision)
    }
    function traerMision(id_mision) {
    // Realiza una petición AJAX al backend para obtener el bloque HTML de la palabra

      return fetch('../api/detalle_mision/' + id_mision)
        .then(response => response.json())
       .then(data => {

        document.querySelector("#descripcion_mision").textContent = data.data.mi_descripcion;
        document.querySelector("#fecha_mision").textContent = "Válido hasta: "+formatearFecha(data.data.mi_fecha_registro_fin);
        lista_recompensa = document.querySelector("#recompensas_lista");


        data.data.recompensas.forEach((recompensa, idx) => {
          var recompensaElement = document.createElement('div');
          recompensaElement.className = 'reward-option' + (idx === 0 ? ' selected' : '');
          recompensaElement.setAttribute('data-reward', 'suscripciones');

          recompensaElement.innerHTML = `
            <div>
              <span class="reward-title">${recompensa.re_titulo}</span>
              <span class="reward-desc">${recompensa.re_descripcion}</span>
            </div>
          `;
          lista_recompensa.appendChild(recompensaElement);
        });
          console.log(data);
        })
        .catch(error => {
          console.log('❌ Error al agregar el tag de palabra clave:', error);
        });
    }

    function formatearFecha(fechaISO) {
      if (!fechaISO) return 'Por definir';

      try {
        var fecha = new Date(fechaISO);

        if (isNaN(fecha.getTime())) {
          return 'Fecha inválida';
        }

        var dia = fecha.getDate();
        var meses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
          'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
        var año = fecha.getFullYear();

        return dia + ' de ' + meses[fecha.getMonth()] + ' ' + año;

      } catch (e) {
        console.log('Error formateando fecha:', e);
        return 'Error en fecha';
      }
    }
  </script>
</body>

</html>